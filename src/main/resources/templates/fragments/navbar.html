<div th:fragment="navbar">
  <nav>
    <div class="nav-left">
      <a href="/" class="app-name" th:text="#{app.name}">Name of App</a>
    </div>
    <div class="nav-center">

      <a href="/item/all">
        <img src="/svg/shopping_bag.svg" alt="Shop">
      </a>

      <form action="/item/all" method="get" class="search-form">
        <input type="text" id="search" name="search" placeholder="Search" th:value="${search}">
        <script>
          window.addEventListener('load', function() {
            var searchBox = document.getElementById('search');
            var searchResultsContainer = document.getElementById('searchResultsContainer');

            searchBox.addEventListener('input', function() {
              let searchText = this.value;
              if (searchText.trim() === '') {
                searchResultsContainer.innerHTML = '';
              } else {
                fetch(`/item/search?search=${searchText}`)
                        .then(response => response.text())
                        .then(html => {
                          searchResultsContainer.innerHTML = html;
                        });
              }
            });

            searchBox.addEventListener('focus', function() {
              searchResultsContainer.style.display = 'block';
            });

            searchBox.addEventListener('blur', function() {
              setTimeout(function() {
                searchResultsContainer.style.display = 'none';
              }, 300);
            });
          });
        </script>
        <button type="submit">
          <img src="/svg/search/search.svg" alt="Search">
        </button>
      </form>
    </div>
    <div class="nav-right">
      <p id="exchangeRate" style="color: black">PLN -> <span></span></p>
      <select id="currencySelect">
        <!-- Options will be populated by JavaScript -->
      </select>
      <div th:if="${isLoggedIn && user != null}" class="nav-user">
        <a href="/user/cart">
          <img src="/svg/shopping_cart.svg" alt="Cart" class="cart-image">
        </a>
        <a href="/profile">
          <div class="profile">
            <img th:src="${user.resolveImage()}" alt="User Image"  class="profile-image">
            <span th:text="${user.username}"></span>
          </div>
        </a>
        <a href="/api/logout">Logout</a>
      </div>
      <div th:if="${!isLoggedIn || user == null}" class="nav-user">
        <a href="/api/login/form">Login</a>
      </div>
    </div>

  </nav>
  <div id="searchResultsContainer"></div>
</div>